-- ‚ö° Ultra Instant TP Auto Candy Farm (Patched Discord Log & ServerHop)
-- Teleports 1-by-1 + Rapid auto Open + Auto Retry if Teleport Fails
-- Tracks Candy gained per server + total + session duration
-- Discord log guaranteed before server hop (fallback queue_on_teleport)
-- Author: Capm (modified by Durckzdf)

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

--- SETTINGS ---
local targetActionText = "Open"
local teleportOffset = Vector3.new(0, 3, 0)
local autoFarm = true
local teleportDelay = 0
local loopDelay = 0.01
local clickBurst = 3
local checkEmptyDelay = 1
local serverHopCooldown = 30
local lastServerHop = 0
local retryDelay = 2
local startTime = tick()
local candyStart = 0
local candyTotal = 0
local hopCount = 0
local webhookURL = "[https://canary.discord.com/api/webhooks/1434567789036830944/RMcjO9oDL9N82GCSKT_kFxEnp1fSNA09rw4IKo1Hr7JdhTzAhlH6On2vLc1wzmUvmRJI](https://canary.discord.com/api/webhooks/1434567789036830944/RMcjO9oDL9N82GCSKT_kFxEnp1fSNA09rw4IKo1Hr7JdhTzAhlH6On2vLc1wzmUvmRJI)"

--- Respawn Fix ---
player.CharacterAdded:Connect(function(newChar)
char = newChar
hrp = char:WaitForChild("HumanoidRootPart")
task.wait(3)
print("üßô Respawned, continuing auto farm...")
end)

--- Candy Tracker ---
local function getCandyAmount()
local gui = player:FindFirstChild("PlayerGui")
local candies = gui and gui:FindFirstChild("Candies")
local amount = candies and candies:FindFirstChild("Amount")
if amount then
return tonumber(amount.Text:gsub("%D", ""))
end
return nil
end

--- Discord Logger (Sync + fallback) ---
local function sendToDiscordSync(title, description, timeoutSeconds)
timeoutSeconds = timeoutSeconds or 5
local payload = {
username = "üéÉ Candy Logger",
embeds = {{
title = title,
description = description,
color = 0xFFA500,
footer = { text = "Auto Candy Farm by Durckzdf" },
timestamp = DateTime.now():ToIsoDate()
}}
}
local jsonData = HttpService:JSONEncode(payload)
local reqFunc = http_request or request or HttpPost or (syn and syn.request)
if reqFunc then
local ok, resp = pcall(function()
return reqFunc({
Url = webhookURL,
Method = "POST",
Headers = { ["Content-Type"] = "application/json" },
Body = jsonData
})
end)
if not ok then return false, "request error" end
if type(resp) == "table" then
if resp.StatusCode == 204 or resp.status == 204 then
return true
else
return false, "status "..tostring(resp.StatusCode or resp.status)
end
else
return true
end
else
local ok, res = pcall(function()
return HttpService:PostAsync(webhookURL, jsonData, Enum.HttpContentType.ApplicationJson)
end)
if ok then return true else return false, "HttpService:PostAsync failed" end
end
end

--- BasePart helper ---
local function getBasePartFromAttachment(attachment)
if not attachment or not attachment:IsA("Attachment") then return nil end
local parent = attachment.Parent
while parent and not parent:IsA("BasePart") do
parent = parent.Parent
end
return parent
end

--- Teleport + Rapid Trigger ---
local function teleportAndTrigger(prompt)
if not prompt or not prompt:IsA("ProximityPrompt") then return end
if not hrp or not hrp.Parent then return end
local attachment = prompt.Parent
local part = getBasePartFromAttachment(attachment)
if not part then return end


pcall(function()
    prompt.HoldDuration = 0
    prompt.RequiresLineOfSight = false
    prompt.MaxActivationDistance = math.huge
end)

hrp.CFrame = part.CFrame + teleportOffset
for i = 1, clickBurst do
    task.defer(function()
        pcall(function()
            fireproximityprompt(prompt, 1)
        end)
    end)
end

end

--- Find all "Open" prompts ---
local function getAllOpenPrompts()
local prompts = {}
for _, obj in ipairs(workspace:GetDescendants()) do
if obj:IsA("ProximityPrompt") and obj.Enabled and obj.ActionText:lower() == targetActionText:lower() then
table.insert(prompts, obj)
end
end
return prompts
end

--- Teleport attempt ---
local function tryTeleport(target)
local success, err = pcall(function()
TeleportService:TeleportToPlaceInstance(9391468976, target.id, player)
end)
if not success then
if string.find(tostring(err), "773") then
print("‚ö†Ô∏è Teleport restricted (773). Retrying in " .. retryDelay .. "s...")
task.wait(retryDelay)
return false
else
warn("‚ùå Teleport failed:", err)
end
end
return true
end

--- Server Hop (patched) ---
local function serverHop()
if tick() - lastServerHop < serverHopCooldown then return end
lastServerHop = tick()
hopCount += 1


local candyNow = getCandyAmount() or 0
local candyThisServer = candyNow - candyStart
local timeSpent = (tick() - startTime) / 60
candyTotal += candyThisServer

local summary = string.format(
    "üßç‚Äç‚ôÇÔ∏è ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: **%s**\nüç¨ Candy ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏ô‡∏µ‡πâ: **%d**\nüïì ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏ô‡∏µ‡πâ: **%.2f ‡∏ô‡∏≤‡∏ó‡∏µ**\nüåç ‡∏£‡∏ß‡∏°‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: **%d**\nüéÅ Candy ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: **%d**",
    player.DisplayName or player.Name,
    candyThisServer,
    timeSpent,
    hopCount,
    candyTotal
)

-- ‡∏™‡πà‡∏á Discord ‡∏Å‡πà‡∏≠‡∏ô teleport (retry 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
local maxRetries = 3
local sent = false
for i = 1, maxRetries do
    local ok, err = sendToDiscordSync("üåê Server Hop", summary, 5)
    if ok then
        sent = true
        break
    else
        warn("Discord send failed (attempt "..i.."): "..tostring(err))
        task.wait(0.5)
    end
end

-- fallback queue_on_teleport
if not sent then
    local payloadString = HttpService:JSONEncode({ title="üåê Server Hop (Fallback)", description=summary })
    queue_on_teleport(string.format([[
        local HttpService = game:GetService("HttpService")
        local data = %s
        local webhookURL = "%s"
        local reqFunc = http_request or request or HttpPost or (syn and syn.request)
        if reqFunc then
            pcall(function()
                reqFunc({
                    Url = webhookURL,
                    Method = "POST",
                    Headers = { ["Content-Type"] = "application/json" },
                    Body = HttpService:JSONEncode({
                        username = "üéÉ Candy Logger",
                        embeds = {{
                            title = data.title,
                            description = data.description,
                            color = 0xFFA500,
                            footer = { text = "Auto Candy Farm by Durckzdf" },
                            timestamp = DateTime.now():ToIsoDate()
                        }}
                    })
                })
            end)
        end
        print("üéÉ Auto Candy Farm Reloading on new server...")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ainthewolrd-collab/sss/refs/heads/main/JJS%20AUTO"))()
    ]], payloadString, webhookURL))
end

print("üåê No doors left! Server hopping to new server...")

-- ‡∏î‡∏∂‡∏á server list
local success, data = pcall(function()
    return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/9391468976/servers/Public?sortOrder=Asc&limit=100"))
end)
if not success or not data or not data.data then
    warn("‚ùå Failed to get server list.")
    return
end

local servers = {}
for _, s in ipairs(data.data) do
    if s.playing < s.maxPlayers and s.id ~= game.JobId then
        table.insert(servers, s)
    end
end

if #servers > 0 then
    local target = servers[math.random(1, #servers)]
    print("üõ∞ Hopping to:", target.id)
    while not tryTeleport(target) do
        local newTarget = servers[math.random(1, #servers)]
        print("üîÑ Retrying teleport to:", newTarget.id)
    end
else
    print("‚ö†Ô∏è No available servers found. Retrying soon...")
    task.wait(retryDelay)
    serverHop()
end


end

--- Candy Change Monitor ---
task.spawn(function()
candyStart = getCandyAmount() or 0
while task.wait(3) do
local candyNow = getCandyAmount()
if candyNow and candyNow ~= candyStart then
local diff = candyNow - candyStart
if diff > 0 then
print("üç¨ ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡∏ô‡∏î‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° +", diff)
sendToDiscordSync("üç≠ Candy Update", string.format(
"‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: %s\nüéÅ ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°: +%d\nüç¨ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: %d",
player.DisplayName or player.Name,
diff,
candyNow
))
end
candyStart = candyNow
end
end
end)

--- Infinite teleport loop ---
task.spawn(function()
while task.wait(loopDelay) do
if autoFarm then
local prompts = getAllOpenPrompts()
if #prompts == 0 then
task.wait(checkEmptyDelay)
if #getAllOpenPrompts() == 0 then
serverHop()
end
else
for i, prompt in ipairs(prompts) do
task.spawn(teleportAndTrigger, prompt)
if i % 10 == 0 then task.wait(0.02) end
end
end
end
end
end)

print("üéÉ Ultra Instant TP Auto Candy Farm (Patched Discord Log & ServerHop) Loaded!")
